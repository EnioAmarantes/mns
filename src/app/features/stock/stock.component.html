<mat-card>
    <mat-card-header>
        <mat-card-title><h1>üìä Gest√£o de Estoques</h1></mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <form (ngSubmit)="addMovement()">
            <mat-form-field appearance="outline">
                <mat-label for="type">Tipo:</mat-label>
                <mat-select [(ngModel)]="movement.type" name="type" required (change)="onTypeChange()">
                    <mat-option value="entrada">Entrada</mat-option>
                    <mat-option value="saida">Sa√≠da</mat-option>
                </mat-select>
            </mat-form-field>

            <app-product-combobox [(selectedProduct)]="selectedProduct" #productCombobox></app-product-combobox>

            <mat-form-field appearance="outline">
                <mat-label for="warehouseId">Estoque:</mat-label>
                <mat-select [(ngModel)]="movement.warehouseId" name="warehouseId" disabled="true" required>
                    @for (w of warehouses; track w.id) {
                        <mat-option [value]="w.id">{{ w.name }}</mat-option>
                    }
                </mat-select>

            </mat-form-field>

            @if (movement.type === 'entrada') {
                <mat-form-field appearance="outline">
                    <mat-label for="supplierId">Fornecedor:</mat-label>
                    <mat-select [(ngModel)]="movement.supplierId" name="supplierId" required>
                        @for (s of suppliers; track s.id) {
                            <mat-option [value]="s.id">{{ s.name }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            }

            <mat-form-field appearance="outline">
                <mat-label for="quantity">Quantidade:</mat-label>
                <input matInput [(ngModel)]="movement.quantity" name="quantity" type="number" required placeholder="Qtd" />
            </mat-form-field>
            
            <button matButton="filled" type="submit">Registrar</button>
        </form>
    </mat-card-content>
</mat-card>

<mat-divider></mat-divider>

<mat-card>
        <mat-card-header>
            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                <mat-card-title>üîÑ Movimenta√ß√µes</mat-card-title>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <mat-form-field appearance="outline">
                        <mat-label>Tipo</mat-label>
                        <mat-select [(ngModel)]="filter.type" name="type" (ngModelChange)="filterMoviments()">
                            <mat-option value="">Todos</mat-option>
                            <mat-option value="entrada">Entrada</mat-option>
                            <mat-option value="saida">Sa√≠da</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Ano</mat-label>
                        <mat-select [(ngModel)]="filter.year" name="year" (ngModelChange)="filterMoviments()">
                            @for (year of availableYears; track year) {
                                <mat-option [value]="year">{{ year }}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>M√™s</mat-label>
                        <mat-select [(ngModel)]="filter.month" name="month" (ngModelChange)="filterMoviments()">
                            @for (month of availableMonths; track month.key) {
                                <mat-option [value]="month.key">{{ month.value }}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
        </mat-card-header>

    <mat-card-content>
        <table mat-table [dataSource]="stocksFiltered" class="mat-elevation-z8">
            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef> Data </th>
                <td mat-cell *matCellDef="let element"> {{ element.date | date:'dd/MM/yyyy' }} </td>
            </ng-container>

            <ng-container matColumnDef="product">
                <th mat-header-cell *matHeaderCellDef> Produto </th>
                <td mat-cell *matCellDef="let element"> {{ productName(element.productId) }} </td>
            </ng-container>

            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef> Tipo </th>
                <td mat-cell *matCellDef="let element">
                    @if (element.type === 'entrada') {
                        <span aria-label="Entrada">‚¨áÔ∏è {{element.type | titlecase }}</span>
                    } @else {
                        <span aria-label="Sa√≠da">‚¨ÜÔ∏è {{element.type | titlecase }}</span>
                    }
                </td>
            </ng-container>

            <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef> Quantidade </th>
                <td mat-cell *matCellDef="let element"> {{ element.quantity }} </td>
            </ng-container>

            <ng-container matColumnDef="warehouse">
                <th mat-header-cell *matHeaderCellDef> Estoque </th>
                <td mat-cell *matCellDef="let element"> {{ warehouseNameFn(element.warehouseId) }} </td>
            </ng-container>

            <ng-container matColumnDef="supplier">
                <th mat-header-cell *matHeaderCellDef> Fornecedor </th>
                <td mat-cell *matCellDef="let element"> {{ supplierName(element.supplierId) }} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="getRowClass(row)"></tr>
        </table>
    </mat-card-content>
</mat-card>